name: Extracción de referencias con TypeScript 

on:
  workflow_dispatch:
    inputs:
      test_file:
        description: 'Ruta del archivo de prueba'
        required: true
        default: 'cypress/e2e/Tests/API/Cards/GX3-5811-boardMembers.api.cy.ts'

jobs:
  extract-references:
    runs-on: ubuntu-latest

    steps:
    - name: Check out repository
      uses: actions/checkout@v2

    - name: Cache node_modules
      uses: actions/cache@v2
      with:
        path: |
          ~/.bun
          node_modules
        key: ${{ runner.os }}-node-${{ hashFiles('**/bun.lockb') }}
        restore-keys: |
          ${{ runner.os }}-node-

    - name: Install dependencies with Bun
      run: |
        curl -fsSL https://bun.sh/install | bash
        export PATH="$HOME/.bun/bin:$PATH"
        echo "$HOME/.bun/bin" >> $GITHUB_PATH  # Añadir al PATH global de GitHub Actions
        bun install

    - name: Ejecutar el script de extracción de referencias en TypeScript
      run: |
        bun run scripts/extractReferences.ts "${{ github.event.inputs.test_file }}" > extracted_references.json

    - name: Mostrar el contenido de las referencias extraídas
      run: |
        cat extracted_references.json
        echo "Referencias extraídas completadas"

